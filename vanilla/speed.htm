<!DOCTYPE html>
<html>
<head>
	<title>Speed Pool</title>
	<link href="../forum/Smileys/default/entropy.png" rel="shortcut icon" />
	<style>
		body {
			background-color:black;
			color:white;
			margin:0;
		}
		a {
			color:#6699FF;
			text-decoration:none;
		}
	</style>
	<script src="etgify.js"></script>
</head>
<body>
	Eles: <span id="txte">7</span><input id="Elements" type="range" min="1" max="12" value="7" />
	<br>Cards: <span id="txtc">7</span><input id="Cards" type="range" min="1" max="30" value="7" />
	<br><input type="button" id="go" value="Go" /> Hide:
	<label><input id="hidepillar" type="checkbox" checked>Pillars</label>
	<label><input id="hideshard" type="checkbox">Shards</label>
	<label><input id="hiderare" type="checkbox">Rares</label>
	<label><input id="hidenymph" type="checkbox">Nymphs</label>
	<!--<br>Upgraded:
	<label><input name="upped" type="radio" value="no" checked>No</label>
	<label><input name="upped" type="radio" value="yes">Yes</label>
	<label><input name="upped" type="radio" value="both">Both</label>-->
	<br><div id="infobox"></div>
	<script>
	"use strict";
	var etg = require("./etg");
	var Cards = require("./Cards");
	Cards.loadcards();
	var infobox = document.getElementById("infobox");
	function prValue(id, sid){
		document.getElementById(id).addEventListener("input", function(){
			document.getElementById(sid).textContent = this.value;
		});
	}
	prValue("Elements", "txte");
	prValue("Cards", "txtc");
	document.getElementById("go").addEventListener("click", printstat);
	function printstat(){
		var hide = {};
		["pillar", "shard", "rare", "nymph"].forEach(function(x){
			if (document.getElementById("hide"+x).checked) hide[x] = true;
		});
		//var upped = document.querySelector("input[name='upped']:checked").value;
		function cardfilter(card){
			if (hide.pillar && !card.type) return false;
			if (hide.shard && card.name.match(/^Shard of /)) return false;
			if (hide.rare && (card.tier == 6 || card.tier == 8 || card.tier == 18)) return false;
			if (hide.nymph && (card.tier == 15 || card.tier == 20)) return false;
			return !card.name.match(/^Mark of /);
		}
		while (infobox.firstChild) infobox.firstChild.remove();
		var deck = [], elements = [1,2,3,4,5,6,7,8,9,10,11,12];
		var eles = +document.getElementById("Elements").value;
		var many = +document.getElementById("Cards").value;
		while(eles<elements.length){
			var n = Math.random()*elements.length|0;
			elements.splice(n, 1);
		}
		for(var i=0; i<elements.length; i++){
			var ele = elements[i];
			var cards = Cards.filter(false, function(x){return x.element == ele && cardfilter(x);});
			while (many < cards.length){
				var n = Math.random()*cards.length|0;
				cards.splice(n, 1);
			}
			Array.prototype.push.apply(deck, cards);
		}
		deck.sort(function(x,y){return x.element-y.element});
		for(var i=0; i<deck.length; i+=70){
			var img = document.createElement("img");
			img.src = "http://dek.im/deck/" + deck.slice(i, i+70).map(function(x){return x.code.toString(32)}).join(" ");
			infobox.appendChild(img);
		}
		if (!deck.length) infobox.appendChild(document.createTextNode("No matches"));
		else infobox.appendChild(document.createTextNode(deck.map(function(x){return x.code.toString(32)}).join(" ")))
	}
	printstat();
	</script>
</body>
</html>